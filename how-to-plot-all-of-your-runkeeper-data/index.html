<!doctype html>
<html lang="en">
<head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content='text/html; charset=utf-8' http-equiv='content-type' />

  <title>How to plot all of your Runkeeper Data - Daniel E. Cook</title>
  <meta content='How to plot all of your Runkeeper Data - Daniel E. Cook' property='title' />
  <meta content='How to plot all of your Runkeeper Data - Daniel E. Cook' property='og:title' />


<meta property="og:description" content="Runs in Iowa City  Running and Biking in Chicago   If you use runkeeper and pay for a yearly subscription (runkeeper elite), you can export your data and plot all of your activities simultaneously using R. I&#8217;ve written a script for doing so (Special thanks to flowing data which has a tutorial that helped with a few key parts of this).
The script does a few unique things." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.danielecook.com/how-to-plot-all-of-your-runkeeper-data/" />


<meta property="article:published_time" content="2014-05-30T00:00:00&#43;00:00"/>

<meta property="article:modified_time" content="2014-05-30T00:00:00&#43;00:00"/>








<meta name="generator" content="Hugo 0.55.6" />

<style type="text/css">/*https://coolors.co/afd5aa-f0f2ef-a69f98-3d3d3d-8c6057*/
:root {
  --main-color: #309fff; 
  --secondary-color: #ff622e;
  --logo-text-color: #fff;
  --body-text-color: #3d3d3d;
  --heading-text-color: #383838;
  --background-color: #fff;
  --max-width: 850px;
}</style>
<link href='https://www.danielecook.com/css/tachyons.min.min.css' integrity="" rel="stylesheet" media="screen">
<link href='https://www.danielecook.com/css/styles.min.css' integrity="" rel="stylesheet" media="screen">


<link rel="icon" 
 
  href='/favicon.ico'

type="image/x-icon"/>

<link rel="alternate" type="application/rss+xml" href="https://www.danielecook.com/how-to-plot-all-of-your-runkeeper-data/feed/index.xml" title="Daniel E. Cook" />
</head>
<body class="global-font">
  <div id="nav" class="content-width center">
<nav class="flex-ns justify-between border-box pa3 pl3-l pr2-l mt1 mt0-ns" id="navbar">
  <div class="flex">
    <a class="f4 fw6 ttu no-underline dim bg-main-color pv1 ph2 br2" id="site-title" href='/' title="Home"></a>
  </div>
  
  <div class=" flex-ns mt2 mt0-ns pv1">
    
      <a class="link dim dark-gray f6 dib mr2 mr3-l ttu tracked" href='/about/' title="about">about</a>
    
      <a class="link dim dark-gray f6 dib mr2 mr3-l ttu tracked" href='/' title="blog">blog</a>
    
      <a class="link dim dark-gray f6 dib mr2 mr3-l ttu tracked" href='/photos/' title="photos">photos</a>
    
      <a class="link dim dark-gray f6 dib mr2 mr3-l ttu tracked" href='/projects/' title="projects">projects</a>
    
      <a class="link dim dark-gray f6 dib mr2 mr3-l ttu tracked" href='/contact/' title="contact">contact</a>
    
  </div>
  
</nav>
</div>

  
<main class="center mv4 content-width ph3">
  <div class="f2 fw6 heading-color heading-font post-title">How to plot all of your Runkeeper Data</div>
  
  <p class="silver f6 mt1 mb4 post-meta">
    <time>2014-05-30</time> 
     
    
    &nbsp;&nbsp;<a href='/tags/cycling' class="link silver tag">cycling</a> &nbsp;&nbsp;<a href='/tags/gist' class="link silver tag">gist</a> &nbsp;&nbsp;<a href='/tags/r' class="link silver tag">R</a> &nbsp;&nbsp; 
    
  </p>
  
  <div class="lh-copy post-content">

<div class="fl w-100 pa2">
<div class="fl w-50 ma2 thumbnail">
    <img src="/Screen-Shot-2014-05-27-at-10.50.04-PM.png" />
      <small>Runs in Iowa City</small>
</div>

<div class="fl w-20 ma2 thumbnail">
    <img src="/2-all.png" />
    <small>Running and Biking in Chicago</small>
</div>
</div>

<p>If you use <a href="http://www.runkeeper.com">runkeeper</a> and pay for a yearly subscription (runkeeper elite), you can export your data and plot all of your activities simultaneously using <a href="http://www.r-project.org/"><strong>R</strong></a>. I&#8217;ve written a script for doing so (Special thanks to <a href="http://www.flowingdata.com.com">flowing data</a> which has a tutorial that helped with a few key parts of this).</p>

<p>The script does a few unique things.</p>

<ul>
<li>Runkeeper exports data in <a href="http://www.topografix.com/gpx.asp">gpx format</a>. If you ever pause an activity within runkeeper or you lose GPS reception briefly, the GPS path will get split into multiple paths within the same file. The script will retain all paths and plot them separately.</li>
<li>This script will merge in the type of activities so you can plot different types of activities by color.</li>
<li>Finally, cluster analysis is used to segregate different locations when plotting. If you are like me and have moved around a bit &#8211; this is necessary as plotting distant locations on the same map (e.g. Chicago and Boston) is not feasible and results in distant locations being plotted as single points.<br /></li>
</ul>

<h4 id="directions">Directions</h4>

<ol>
<li>Export your runkeeper data. The option is available for subscribers only under the settings menu.</li>
</ol>

<p><a href="/Screen-Shot-2014-05-27-at-8.09.00-PM.png"><img src="/Screen-Shot-2014-05-27-at-8.09.00-PM-300x198.png" alt="Exporting Runkeeper Data" width="300" height="198" class="img-thumbnail size-medium wp-image-520" /></a></p>

<p class='caption'>
  <small>Exporting can be done from within the settings menu</small>
</p>

<ol>
<li>Place the script below within a folder containing your runkeeper data. Set the <code>num_locations</code> variable to the number of places you have lived/run. This will be used to pull out the number of distinct running locations automatically.</p></li>
<li>Install the necessary R packages. You can run the following code within R to do so.
<br /></li>
</ol>

<pre><code class="language-R">install.packages(&quot;fpc&quot;)
install.packages(&quot;plyr&quot;)
install.packages(&quot;dplyr&quot;)
install.packages(&quot;mapproj&quot;)
</code></pre>

<ol>
<li>Run the script below from within R Studio or on unix based machines using <code>RScript plot_runkeeper.R</code>. If you are using Rstudio, be sure to set the working directory using <code>setwd()</code></li>
</ol>

<pre><code class="language-R"># Special thanks for insights from flowingdata.com regarding this.

library(plotKML)
library(plyr)
library(dplyr)
library(fpc)

num_locations &lt;- 5

# Usage: Place this script in the directory containing your runkeeper data. You can run from terminal using 'Rscript map_runkeeper.R', or
# set your working directory to the location and run within RStudio (use setwd(&quot;~/location/of/runkeeper/data&quot;)).
# See below on how to set the number of clusters.

# GPX files downloaded from Runkeeper
files &lt;- dir(pattern = &quot;\\.gpx&quot;)

# Generate vectors for data frame
index &lt;- c()
latitude &lt;- c()
longitude &lt;- c()
file &lt;- c()

c &lt;- 1 # Set up Counter

# 
for (f in 1:length(files)) {
  curr_route &lt;- readGPX(files[f])
# Treat interrupted GPS paths as seperate routes (useful if you occasionally stop running..walk for a bit, and start again like I do.)
for (i in curr_route$tracks[[1]]) {
  c &lt;- c + 1
  location &lt;- i
  file &lt;- c(file,rep(files[f], dim(location)[1])) 
  index &lt;- c(index, rep(c, dim(location)[1]))
  latitude &lt;- c(latitude, location$lat)
  longitude &lt;- c(longitude, location$lon)
}
}
routes &lt;- data.frame(cbind(index, latitude, longitude,file))

# Because the routes dataframe takes a while to generate for some folks - save it!
save(routes, file=&quot;routes.Rdata&quot;)
# Use to load as needed.
load(&quot;routes.Rdata&quot;)

# Fix data types
routes$file &lt;- as.character(routes$file)
routes$latitude &lt;- as.numeric(levels(routes$latitude)[routes$latitude])
routes$longitude &lt;- as.numeric(levels(routes$longitude)[routes$longitude])
routes &lt;- transform(routes, index = as.numeric(index))

# Load Meta Data
meta_data &lt;- read.csv(&quot;cardioActivities.csv&quot;, stringsAsFactors=FALSE)
meta_data &lt;- rename(meta_data, c(&quot;GPX.File&quot; = &quot;file&quot;))

# Bind routes
routes &lt;- left_join(routes, meta_data, by=&quot;file&quot;) %.%
  arrange(index)


# Use this function specify activity color if you have multiple activities.
activity_color &lt;- function(activity) {
  if (activity==&quot;Cycling&quot;) {
    color = &quot;#00000060&quot;
  } else if (activity==&quot;Hiking&quot;) {
    color = &quot;#00000060&quot;
  } else {
    color = &quot;#0080ff60&quot;
  }
  color
}

# Identify clusters of points, which will correspond to locations you have run. For example,
# I have run in Boston, Iowa City, Chicago, and a few other cities. You will want to set the minimum krange
# to the number of cities you have run in (5 in my case).
clusters &lt;- pamk(routes[,c(&quot;latitude&quot;, &quot;longitude&quot;)], krange=num_locations:20, diss=T, usepam=F)$pamobject$medoids

# Plot Everything
for (r in 1:max(row(clusters))) {
  print(r)
  lat_range &lt;- clusters[r,][1] + rnorm(20, sd=0.1)
  lon_range &lt;-clusters[r,][2] + rnorm(20, sd=0.1)
  setroutes &lt;- filter(routes, (latitude &gt; min(lat_range) &amp; latitude &lt; max(lat_range)),
                      longitude &gt; min(lon_range) &amp;  longitude &lt; max(lon_range))
  
  routeIds &lt;- unique(setroutes$index)
  
  # Albers projection
  locProj &lt;- mapproject(setroutes$longitude, setroutes$latitude, &quot;rectangular&quot;, par=38)
  setroutes$latproj &lt;- locProj$x
  setroutes$lonproj &lt;- locProj$y
  
  
  # Map the projected points
  pdf(sprintf(&quot;%s-all.pdf&quot;, r))
  
  plot(setroutes$latproj, setroutes$lonproj, type=&quot;n&quot;, asp=1, axes=FALSE, xlab=&quot;&quot;, ylab=&quot;&quot;)
  for (i in routeIds) {
    currRoute &lt;- subset(setroutes, index==i)
    lines(currRoute$latproj, currRoute$lonproj, col=activity_color(currRoute$Type), lwd=0.4)
  }
  dev.off()
}

</code></pre>
</div>
  
        <div id='comments'></div>
  
</main>

   






<div class="tl fixed list-pages lh-copy" id="contents-list"></div>




<div class="pagination tc tr-l db fixed-l bottom-2-l right-2-l mb3 mb0-l">
  
<a id="scroll-to-top" class="f6 o-0 link br2 ph2 pv1 mb1 bg-main-color pointer" onclick="topFunction()" style="color: #fff; visibility: hidden; display: none; transition: opacity .5s, visibility .5s;" title="back to top">back to top</a>
<br>
  <p class="mb0 mt2 next_prev">
  ← <a href="https://www.danielecook.com/where-i-run-and-bike-in-chicago/">prev post</a>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  <a href="https://www.danielecook.com/a-short-tour-around-lake-michigan/">next post</a> →
  </p>
</div>



  <div class='cb'></div>
<footer class="content-width mt3 mb4 f6 center ph3 gray tc tl-l">
    <a href="http://creativecommons.org/licenses/by/3.0/deed.en_US" class='cc'>CC</a>
    <br /><br />
</footer>
  



<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
<style>.is-active-link::before { background-color: var(--secondary-color); }</style>




<script type="text/javascript">
var prevScrollpos = window.pageYOffset;
window.onscroll = function() {
  var currentScrollPos = window.pageYOffset;


  
  if (document.body.scrollTop > 1000 || document.documentElement.scrollTop > 1000) {
      document.getElementById("scroll-to-top").style.display = "inline";
      document.getElementById("scroll-to-top").style.visibility = "visible";
      document.getElementById("scroll-to-top").style.opacity = "1";
  } else {
      document.getElementById("scroll-to-top").style.visibility = "hidden";
      document.getElementById("scroll-to-top").style.opacity = "0";
  }
  
  prevScrollpos = currentScrollPos;
}


function topFunction() {
  document.body.scrollTop = 0; 
  document.documentElement.scrollTop = 0; 
}






if (document.getElementById("contents-list") !== null && document.getElementsByClassName("post-content").length !== 0) { 
  tocbot.init({
    
    tocSelector: '#contents-list',
    
    contentSelector: '.post-content',
    
    headingSelector: 'h1, h2, h3',
  });
}


</script>





  <script src='https://www.danielecook.com/js/instantclick.js' integrity="" data-no-instant></script>
    <script data-no-instant>

    function utterances(index) {
        var discussion = document.getElementById('comments');
        if (!discussion) {
            return;
        }
        var script = document.createElement('script');
        script.src = 'https://utteranc.es/client.js';
        script.setAttribute('repo', 'danielecook/danielecook.com');
        script.setAttribute('issue-term', index);
        script.setAttribute('theme', 'github-light');
        script.setAttribute('crossorigin', 'anonymous');
        discussion.appendChild(script);
    }

    InstantClick.on('change', function() {
        utterances(location.pathname + location.search)
    });


    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
            m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-39176354-1', 'auto');

        InstantClick.on('change', function() {
            ga('send', 'pageview', location.pathname + location.search);
      });
       

    InstantClick.init();
    </script>
</body>
</html>